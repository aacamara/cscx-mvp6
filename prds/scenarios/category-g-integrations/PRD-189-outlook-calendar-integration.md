# PRD-189: Outlook Calendar Integration

## Overview
| Field | Value |
|-------|-------|
| **PRD ID** | PRD-189 |
| **Title** | Outlook Calendar Integration |
| **Category** | G: CRM & Tool Integrations |
| **Priority** | P1 |
| **Status** | Not Started |
| **Created** | 2026-01-29 |
| **Last Updated** | 2026-01-29 |

## Problem Statement
Organizations using Microsoft 365 cannot leverage CSCX.AI's calendar integration features. CSMs with Outlook calendars need the same meeting scheduling, tracking, and automation capabilities available to Google Calendar users.

## User Stories

### Primary User Stories
1. **As a CSM using Outlook**, I want to schedule customer meetings from CSCX.AI with meetings appearing in my Outlook calendar.
2. **As a CSM**, I want my Outlook meeting history with customers synced to CSCX.AI for engagement tracking.
3. **As CSCX.AI**, I want to include Outlook meeting data in health score calculations.

### Secondary User Stories
4. **As a CSM**, I want to check availability across Outlook calendars when scheduling.
5. **As a CSM**, I want meeting prep briefs delivered before Outlook calendar events.

## Functional Requirements

### FR-1: Microsoft Graph Authentication
- Support Microsoft OAuth 2.0 via Azure AD
- Request permissions:
  - `Calendars.ReadWrite`
  - `Calendars.Read.Shared`
  - `Mail.Send` (for meeting invites)
- Multi-tenant application support
- Token storage and refresh

### FR-2: Calendar Event Sync
- Bi-directional event synchronization
- Sync event attributes:
  - Subject, body
  - Start/end time and timezone
  - Attendees (required/optional)
  - Location (physical/online)
  - Status (busy, free, tentative)
  - Recurrence patterns

### FR-3: Customer Meeting Detection
- Match meetings to customers via:
  - Attendee email domain
  - Subject line patterns
  - Manual association
- Support shared calendars for team visibility

### FR-4: Meeting Creation
- Create events from customer context
- Support Teams meeting creation
- Pre-populate stakeholder attendees
- Apply meeting templates
- Requires HITL approval

### FR-5: Availability Management
- Query user free/busy times
- Check room availability
- Suggest meeting times via FindMeetingTimes API
- Respect working hours settings

### FR-6: Meeting Metrics
- Track meeting engagement per customer
- Calculate frequency, duration, attendance
- Feed metrics to health score

## Non-Functional Requirements

### NFR-1: Performance
- Event creation < 3 seconds
- Sync latency < 5 minutes
- Availability check < 2 seconds

### NFR-2: Compatibility
- Support Exchange Online
- Support hybrid Exchange environments
- Handle calendar permission variations

## Technical Implementation

### API Endpoints
```
POST   /api/integrations/outlook/connect
GET    /api/integrations/outlook/callback
GET    /api/outlook/calendar/events
POST   /api/outlook/calendar/events
PUT    /api/outlook/calendar/events/:id
DELETE /api/outlook/calendar/events/:id
GET    /api/outlook/calendar/availability
POST   /api/outlook/calendar/findmeetingtimes
```

### Microsoft Graph API Usage
```javascript
// List calendar events
GET https://graph.microsoft.com/v1.0/me/calendar/events
?$filter=start/dateTime ge '2026-01-01T00:00:00'
&$select=subject,start,end,attendees,location,onlineMeeting

// Create event with Teams meeting
POST https://graph.microsoft.com/v1.0/me/calendar/events
{
  "subject": "QBR - Acme Corp",
  "body": {
    "contentType": "HTML",
    "content": "Quarterly Business Review<br>Generated by CSCX.AI"
  },
  "start": {
    "dateTime": "2026-02-15T10:00:00",
    "timeZone": "Pacific Standard Time"
  },
  "end": {
    "dateTime": "2026-02-15T11:00:00",
    "timeZone": "Pacific Standard Time"
  },
  "attendees": [
    {
      "emailAddress": {"address": "john@acmecorp.com"},
      "type": "required"
    }
  ],
  "isOnlineMeeting": true,
  "onlineMeetingProvider": "teamsForBusiness"
}

// Find meeting times
POST https://graph.microsoft.com/v1.0/me/findMeetingTimes
{
  "attendees": [{"emailAddress": {"address": "john@acmecorp.com"}}],
  "meetingDuration": "PT1H",
  "timeConstraint": {
    "timeslots": [{
      "start": {"dateTime": "2026-02-01T09:00:00", "timeZone": "PST"},
      "end": {"dateTime": "2026-02-07T17:00:00", "timeZone": "PST"}
    }]
  }
}
```

### Database Schema
```sql
CREATE TABLE outlook_calendar_sync (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  meeting_id UUID REFERENCES meetings(id),
  outlook_event_id TEXT UNIQUE,
  user_id TEXT,
  calendar_id TEXT,
  last_synced_at TIMESTAMPTZ,
  sync_direction VARCHAR(10)
);
```

## User Interface

### Calendar Integration Settings
- Connection status
- Default calendar selection
- Sync preferences
- Teams meeting default toggle

### Meeting Scheduler
- Availability grid view
- Suggested times from FindMeetingTimes
- Teams meeting toggle
- Template selection

## Acceptance Criteria

### AC-1: Authentication
- [ ] Azure AD OAuth completes
- [ ] Token refresh works
- [ ] Multi-tenant support functional

### AC-2: Sync
- [ ] Events sync correctly
- [ ] Customer detection works
- [ ] Recurrence handled properly

### AC-3: Meeting Creation
- [ ] Can create from customer view
- [ ] Teams meeting option works
- [ ] Invites sent to attendees

## Chat UI Integration

### Natural Language Commands
| Command | Action |
|---------|--------|
| "Schedule a Teams meeting with [account]" | Create with Teams |
| "Find time for a meeting with [account]" | Use FindMeetingTimes |
| "Show my Outlook calendar for this week" | Display events |

## Success Metrics
| Metric | Target |
|--------|--------|
| Sync accuracy | > 99% |
| Meeting creation success | > 99% |
| Parity with Google Calendar | 100% |

## Related PRDs
- PRD-188: Google Calendar Sync
- PRD-187: Microsoft Teams Integration
