{
  "project": "CSCX.AI",
  "branchName": "ralph/onboarding-completion",
  "description": "Complete the onboarding flow - save customers, persist contracts, add Google connect UI",
  "userStories": [
    {
      "id": "US-001",
      "title": "Save customer on onboarding completion",
      "description": "When user completes onboarding, save the customer to the database with parsed contract data.",
      "acceptanceCriteria": [
        "Find UnifiedOnboarding component and its onComplete handler in App.tsx",
        "Modify onComplete to call POST /api/customers with: name (from contractData.company_name), arr (from contractData.arr), industry, csm_user_id",
        "Pass the auth token in headers for RLS",
        "Show success toast after save: 'Customer created successfully'",
        "Navigate to /customers/{newCustomerId} after successful save",
        "Handle errors gracefully with error toast",
        "Run `npx tsc --noEmit` - exits with code 0"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Check context/OnboardingContext.tsx for contract data structure. Customer API is at server/src/routes/customers.ts"
    },
    {
      "id": "US-002",
      "title": "Save contract linked to customer",
      "description": "After customer is created, save the contract record linked to that customer.",
      "acceptanceCriteria": [
        "After successful customer creation in US-001, call POST /api/contracts",
        "Include customer_id from the created customer response",
        "Save: file_name, file_type, file_size, parsed_data (full JSON), status='parsed'",
        "Contract should be queryable via GET /api/contracts?customer_id={id}",
        "Run `npx tsc --noEmit` - exits with code 0"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Contract routes at server/src/routes/contracts.ts. parsed_data column is JSONB."
    },
    {
      "id": "US-003",
      "title": "Upload contract file to Supabase Storage",
      "description": "Persist the uploaded contract file so users can download it later.",
      "acceptanceCriteria": [
        "In server/src/routes/contracts.ts upload endpoint, after parsing, upload file to Supabase Storage",
        "Use bucket name 'contracts' with path: {user_id}/{customer_id}/{filename}",
        "Get public URL from Supabase and store in contracts.file_url column",
        "Return file_url in the upload response",
        "Create bucket with appropriate RLS if needed (check Supabase docs)",
        "Run `npx tsc --noEmit` - exits with code 0"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Use @supabase/supabase-js storage client. Bucket may need to be created in Supabase dashboard first."
    },
    {
      "id": "US-004",
      "title": "Add Google Workspace connect UI",
      "description": "Add a way for users to connect their Google account after initial signup.",
      "acceptanceCriteria": [
        "Create components/Settings.tsx or components/GoogleConnect.tsx component",
        "Add Settings button/link in the navigation (header or sidebar)",
        "Show 'Connect Google Workspace' button if not connected",
        "Button opens /api/google/auth/connect in same window or popup",
        "Check connection status via GET /api/google/auth/status",
        "Show connected state with user's Google email when connected",
        "Add 'Disconnect' button that calls DELETE /api/google/auth/disconnect",
        "Run `npx tsc --noEmit` - exits with code 0"
      ],
      "priority": 4,
      "passes": false,
      "notes": "OAuth endpoints already exist in server/src/routes/google/auth.ts. AuthContext has Google token state."
    },
    {
      "id": "US-005",
      "title": "Display saved customers in CustomerList",
      "description": "Show the user's saved customers on the main customers page.",
      "acceptanceCriteria": [
        "CustomerList component fetches GET /api/customers on mount",
        "Include auth token in request headers for RLS filtering",
        "Display customers in a grid/list with: name, ARR, health_score, renewal_date",
        "Click on customer card navigates to customer detail view",
        "Show empty state when no customers: 'No customers yet. Start by onboarding a new customer.'",
        "Add loading state while fetching",
        "Run `npx tsc --noEmit` - exits with code 0"
      ],
      "priority": 5,
      "passes": false,
      "notes": "CustomerList.tsx likely exists. Check if it's fetching from API or using mock data."
    },
    {
      "id": "US-006",
      "title": "Show contract data in customer detail",
      "description": "Display the parsed contract information when viewing a customer.",
      "acceptanceCriteria": [
        "CustomerDetail component fetches GET /api/contracts?customer_id={id}",
        "Add tabs or sections: Overview, Contracts, Stakeholders",
        "Contracts section shows list of contracts with file_name, upload date, status",
        "Add 'Download' button that links to file_url (if available)",
        "Stakeholders section shows extracted stakeholders with name, role, contact",
        "Run `npx tsc --noEmit` - exits with code 0"
      ],
      "priority": 6,
      "passes": false,
      "notes": "CustomerDetail.tsx should exist. May need to add API call for contracts."
    }
  ]
}
