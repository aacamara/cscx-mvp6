## Codebase Patterns
- Frontend uses AuthContext for auth state and getAuthHeaders() for API calls
- API_URL from import.meta.env.VITE_API_URL
- Supabase client in server/src/services/supabase.ts
- Customer routes at server/src/routes/customers.ts
- Contract routes at server/src/routes/contracts.ts - POST /api/contracts for creating with customer_id
- Google auth routes at server/src/routes/google/auth.ts
- OnboardingContext manages workflow state
- Toast notifications use inline state pattern (useState with setTimeout for auto-dismiss)
- ContractData type in types/workflow.ts does NOT include industry; industry is in CompanyResearch
- UnifiedOnboarding.onComplete receives { contract: ContractData; plan: OnboardingPlan; fileMetadata?: FileMetadata }
- ContractInput from uploads has fileName and mimeType but not file size - estimate from base64 content length * 0.75

---

# Onboarding Completion Progress Log

Initialized: Ready to complete the onboarding flow

---

## 2026-01-28 - US-001
- What was implemented: Save customer on onboarding completion
- Files changed: App.tsx
- Changes:
  - Added getAuthHeaders() import from useAuth hook
  - Added toast notification state and showToast() helper function
  - Modified onComplete handler in UnifiedOnboarding to:
    - Call POST /api/customers with name, arr, status from contract data
    - Include auth headers for RLS
    - Show success toast "Customer created successfully"
    - Navigate to customer-detail view with new customer ID
    - Handle errors gracefully with error toast
  - Added toast UI component (fixed position, top-right)
- **Learnings for future iterations:**
  - ContractData doesn't have industry field - that's in CompanyResearch
  - Customer API accepts: name, industry (optional), arr, status, renewal_date, csm_name, primary_contact, tags
  - Pre-existing TypeScript errors in other files (types/index.ts, AgentControlCenter, WorkspaceAgent) - not related to US-001
  - Toast pattern: use useState + setTimeout(4000ms) for auto-dismiss

---

## 2026-01-28 - US-002
- What was implemented: Save contract linked to customer after onboarding completion
- Files changed:
  - server/src/routes/contracts.ts - Added POST /api/contracts endpoint
  - components/UnifiedOnboarding.tsx - Added file metadata tracking
  - App.tsx - Added contract save after customer creation
- Changes:
  - Added POST /api/contracts endpoint that accepts customer_id, file_name, file_type, file_size, parsed_data, status
  - Endpoint extracts company_name, arr, contract_period from parsed_data for easier querying
  - Added FileMetadata interface to UnifiedOnboarding to track file info through workflow
  - Capture file metadata on upload (estimate size from base64 content)
  - Call onComplete with contract, plan, and fileMetadata when deploying agents
  - App.tsx now calls POST /api/contracts after successful customer creation
  - Contract save failure is logged but doesn't block customer creation success
- **Learnings for future iterations:**
  - ContractInput doesn't have fileSize; estimate from base64 content length * 0.75
  - Express routes order matters: POST / must come before GET /:id or params will catch it
  - db.saveContract accepts any Record<string, unknown> - flexible for adding new fields
  - Contract linked to customer via customer_id field in contracts table

---
